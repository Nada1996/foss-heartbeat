{"url": "https://api.github.com/repos/rails-girls-summer-of-code/rgsoc-teams/issues/comments/265717548", "html_url": "https://github.com/rails-girls-summer-of-code/rgsoc-teams/pull/565#issuecomment-265717548", "issue_url": "https://api.github.com/repos/rails-girls-summer-of-code/rgsoc-teams/issues/565", "id": 265717548, "user": {"login": "klappradla", "id": 3491815, "avatar_url": "https://avatars3.githubusercontent.com/u/3491815?v=4", "gravatar_id": "", "url": "https://api.github.com/users/klappradla", "html_url": "https://github.com/klappradla", "followers_url": "https://api.github.com/users/klappradla/followers", "following_url": "https://api.github.com/users/klappradla/following{/other_user}", "gists_url": "https://api.github.com/users/klappradla/gists{/gist_id}", "starred_url": "https://api.github.com/users/klappradla/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/klappradla/subscriptions", "organizations_url": "https://api.github.com/users/klappradla/orgs", "repos_url": "https://api.github.com/users/klappradla/repos", "events_url": "https://api.github.com/users/klappradla/events{/privacy}", "received_events_url": "https://api.github.com/users/klappradla/received_events", "type": "User", "site_admin": false}, "created_at": "2016-12-08T11:22:06Z", "updated_at": "2016-12-08T11:22:06Z", "author_association": "MEMBER", "body_html": "<p>I haven't done fontend code in a while <a href=\"https://github.com/f3pix\" class=\"user-mention\">@F3PiX</a>, so just some thoughts I have when looking at this PR, eventually not really relevant <g-emoji class=\"g-emoji\" alias=\"see_no_evil\" fallback-src=\"https://assets-cdn.github.com/images/icons/emoji/unicode/1f648.png\">\ud83d\ude48</g-emoji></p>\n<p>So first, I think it's weird, that this piece of code is <strong>always</strong> evaluated completely, even if the client does not show the respective form (80% of all cases I think). Also, you're right, the application code, e.g. having max 3 attendances, should not be tied as closely to the fontend code. I prefer to use data attributes here to just pass some data from Ruby to JS <g-emoji class=\"g-emoji\" alias=\"wink\" fallback-src=\"https://assets-cdn.github.com/images/icons/emoji/unicode/1f609.png\">\ud83d\ude09</g-emoji></p>\n<p>So this would look aprox like this:</p>\n<div class=\"highlight highlight-source-js\"><pre><span class=\"pl-en\">$</span>(<span class=\"pl-k\">function</span>() {\n    <span class=\"pl-k\">var</span> fieldsCount\n    <span class=\"pl-k\">var</span> maxFieldsCount\n    <span class=\"pl-k\">var</span> $addLink\n    <span class=\"pl-k\">var</span> $form <span class=\"pl-k\">=</span> <span class=\"pl-en\">$</span>(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>[data-behavior='attendances-form']<span class=\"pl-pds\">\"</span></span>)\n\n    <span class=\"pl-k\">function</span> <span class=\"pl-en\">init</span>() {\n        maxFieldsCount <span class=\"pl-k\">=</span> <span class=\"pl-smi\">$form</span>.<span class=\"pl-c1\">data</span>(<span class=\"pl-s\"><span class=\"pl-pds\">'</span>max-fields<span class=\"pl-pds\">'</span></span>);\n        $addLink       <span class=\"pl-k\">=</span> <span class=\"pl-en\">$</span>(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>[data-behavior='add-link']<span class=\"pl-pds\">\"</span></span>)\n        fieldsCount    <span class=\"pl-k\">=</span> <span class=\"pl-smi\">$form</span>.<span class=\"pl-smi\">fields</span>.<span class=\"pl-c1\">length</span>\n        <span class=\"pl-en\">_run</span>()\n    }\n\n    <span class=\"pl-k\">function</span> <span class=\"pl-en\">_run</span>() {\n        <span class=\"pl-en\">_toggleAddLink</span>()\n\n        <span class=\"pl-smi\">$form</span>.<span class=\"pl-en\">on</span>(<span class=\"pl-s\"><span class=\"pl-pds\">'</span>nested:fieldAdded:attendances<span class=\"pl-pds\">'</span></span>, <span class=\"pl-k\">function</span>() {\n            fieldsCount <span class=\"pl-k\">+=</span> <span class=\"pl-c1\">1</span>;\n            <span class=\"pl-en\">_toggleAddLink</span>();\n        });\n\n        <span class=\"pl-smi\">$form</span>.<span class=\"pl-en\">on</span>(<span class=\"pl-s\"><span class=\"pl-pds\">'</span>nested:fieldRemoved:attendances<span class=\"pl-pds\">'</span></span>, <span class=\"pl-k\">function</span>() {\n            fieldsCount <span class=\"pl-k\">-=</span> <span class=\"pl-c1\">1</span>;\n            <span class=\"pl-en\">_toggleAddLink</span>();\n        });\n    }\n\n    <span class=\"pl-k\">function</span> <span class=\"pl-en\">_toggleAddLink</span>() {\n        <span class=\"pl-smi\">$addLink</span>.<span class=\"pl-c1\">toggle</span>(fieldsCount <span class=\"pl-k\">&lt;=</span> maxFieldsCount);\n    }\n      \n    <span class=\"pl-k\">if</span> (<span class=\"pl-smi\">$form</span>.<span class=\"pl-en\">exists</span>()) <span class=\"pl-en\">init</span>()\n});</pre></div>\n<p>I did not run this code, just wrote it straight here in the editor - so it prob won't work <g-emoji class=\"g-emoji\" alias=\"wink\" fallback-src=\"https://assets-cdn.github.com/images/icons/emoji/unicode/1f609.png\">\ud83d\ude09</g-emoji>  Just added it to easier explain what I mean: init all the callbacks only if the respective form is actually there and get more data from the application.</p>", "body_text": "I haven't done fontend code in a while @F3PiX, so just some thoughts I have when looking at this PR, eventually not really relevant \ud83d\ude48\nSo first, I think it's weird, that this piece of code is always evaluated completely, even if the client does not show the respective form (80% of all cases I think). Also, you're right, the application code, e.g. having max 3 attendances, should not be tied as closely to the fontend code. I prefer to use data attributes here to just pass some data from Ruby to JS \ud83d\ude09\nSo this would look aprox like this:\n$(function() {\n    var fieldsCount\n    var maxFieldsCount\n    var $addLink\n    var $form = $(\"[data-behavior='attendances-form']\")\n\n    function init() {\n        maxFieldsCount = $form.data('max-fields');\n        $addLink       = $(\"[data-behavior='add-link']\")\n        fieldsCount    = $form.fields.length\n        _run()\n    }\n\n    function _run() {\n        _toggleAddLink()\n\n        $form.on('nested:fieldAdded:attendances', function() {\n            fieldsCount += 1;\n            _toggleAddLink();\n        });\n\n        $form.on('nested:fieldRemoved:attendances', function() {\n            fieldsCount -= 1;\n            _toggleAddLink();\n        });\n    }\n\n    function _toggleAddLink() {\n        $addLink.toggle(fieldsCount <= maxFieldsCount);\n    }\n      \n    if ($form.exists()) init()\n});\nI did not run this code, just wrote it straight here in the editor - so it prob won't work \ud83d\ude09  Just added it to easier explain what I mean: init all the callbacks only if the respective form is actually there and get more data from the application.", "body": "I haven't done fontend code in a while @F3PiX, so just some thoughts I have when looking at this PR, eventually not really relevant \ud83d\ude48 \r\n\r\nSo first, I think it's weird, that this piece of code is **always** evaluated completely, even if the client does not show the respective form (80% of all cases I think). Also, you're right, the application code, e.g. having max 3 attendances, should not be tied as closely to the fontend code. I prefer to use data attributes here to just pass some data from Ruby to JS \ud83d\ude09 \r\n\r\nSo this would look aprox like this:\r\n```javascript\r\n$(function() {\r\n    var fieldsCount\r\n    var maxFieldsCount\r\n    var $addLink\r\n    var $form = $(\"[data-behavior='attendances-form']\")\r\n\r\n    function init() {\r\n        maxFieldsCount = $form.data('max-fields');\r\n        $addLink       = $(\"[data-behavior='add-link']\")\r\n        fieldsCount    = $form.fields.length\r\n        _run()\r\n    }\r\n\r\n    function _run() {\r\n        _toggleAddLink()\r\n\r\n        $form.on('nested:fieldAdded:attendances', function() {\r\n            fieldsCount += 1;\r\n            _toggleAddLink();\r\n        });\r\n\r\n        $form.on('nested:fieldRemoved:attendances', function() {\r\n            fieldsCount -= 1;\r\n            _toggleAddLink();\r\n        });\r\n    }\r\n\r\n    function _toggleAddLink() {\r\n        $addLink.toggle(fieldsCount <= maxFieldsCount);\r\n    }\r\n      \r\n    if ($form.exists()) init()\r\n});\r\n```\r\n\r\nI did not run this code, just wrote it straight here in the editor - so it prob won't work \ud83d\ude09  Just added it to easier explain what I mean: init all the callbacks only if the respective form is actually there and get more data from the application."}