{"url": "https://api.github.com/repos/rails-girls-summer-of-code/rgsoc-teams/pulls/comments/106862829", "pull_request_review_id": 27802616, "id": 106862829, "diff_hunk": "@@ -126,40 +126,47 @@\n \n   describe 'PUT signoff' do\n     context 'as a project_maintainer of this season' do\n-      let!(:project) { create(:project, :in_current_season, :accepted, submitter: user) }\n+      let!(:project)   { create(:project, :in_current_season, :accepted, submitter: user) }\n \n       before { sign_in user }\n \n       context 'for an application that they are a mentor of' do\n-        let(:application) { create(:application, :in_current_season, :for_project, project1: project) }\n+        let(:application)   { create(:application, :in_current_season, :for_project, project1: project) }\n+        let(:m_application) { Mentor::Application.new(id: application.id, choice: 1) }\n \n-        it 'sets the sign-off timestamp' do\n-          expect { put :signoff, params: { id: application.id } }\n-            .to change { application.reload.signed_off_at }.from nil\n+        subject { put :signoff, params: { id: application.id } }\n+\n+        it 'sets the sign-off timestamp for the project choice' do\n+          expect { subject }\n+            .to change { application.reload.application_data['signed_off_at_project1'] }\n+            .from nil\n         end\n \n-        it 'set persists the mentor who signed-off' do\n-          expect { put :signoff, params: { id: application.id } }\n-            .to change { application.reload.signatory }.to user\n+        it 'set persists the mentor id who signed-off' do\n+          expect { subject }\n+            .to change { application.reload.application_data['signed_off_by_project1'] }\n+            .to(user.id.to_s)\n         end\n \n         it 'redirects back to index' do\n-          put :signoff, params: { id: application.id }\n+          subject\n           expect(response).to redirect_to mentor_applications_path\n           expect(flash[:notice]).to be_present\n         end\n \n         context 'undo\\'ing the sign-off' do\n-          before { application.sign_off! as: user }\n+          before { m_application.sign_off! as: user }\n \n-          it 'sets the sign-off timestamp' do\n-            expect { put :signoff, params: { id: application.id } }\n-              .to change { application.reload.signed_off_at }.to nil\n+          it 'resets the sign-off timestamp' do\n+            expect { subject }\n+              .to change { application.reload.application_data['signed_off_at_project1'] }\n+              .to nil\n           end\n \n-          it 'set persists the mentor who signed-off' do\n-            expect { put :signoff, params: { id: application.id } }\n-              .to change { application.reload.signatory }.to nil\n+          it 'resets the mentor who signed-off' do\n+            expect { subject }\n+              .to change { application.reload.application_data['signed_off_by_project1'] }", "path": "spec/controllers/mentor/applications_controller_spec.rb", "position": 59, "original_position": 59, "commit_id": "fee3ed2fe5604f2e8490d6fce6056956db44c670", "original_commit_id": "7d6cb352fb54bc1241b2a1ef788d9bba840f10ee", "user": {"login": "beanieboi", "id": 29251, "avatar_url": "https://avatars1.githubusercontent.com/u/29251?v=4", "gravatar_id": "", "url": "https://api.github.com/users/beanieboi", "html_url": "https://github.com/beanieboi", "followers_url": "https://api.github.com/users/beanieboi/followers", "following_url": "https://api.github.com/users/beanieboi/following{/other_user}", "gists_url": "https://api.github.com/users/beanieboi/gists{/gist_id}", "starred_url": "https://api.github.com/users/beanieboi/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/beanieboi/subscriptions", "organizations_url": "https://api.github.com/users/beanieboi/orgs", "repos_url": "https://api.github.com/users/beanieboi/repos", "events_url": "https://api.github.com/users/beanieboi/events{/privacy}", "received_events_url": "https://api.github.com/users/beanieboi/received_events", "type": "User", "site_admin": false}, "body": "should we test this also for `signed_off_at_project2`?", "created_at": "2017-03-20T09:56:19Z", "updated_at": "2017-03-20T14:39:12Z", "html_url": "https://github.com/rails-girls-summer-of-code/rgsoc-teams/pull/699#discussion_r106862829", "pull_request_url": "https://api.github.com/repos/rails-girls-summer-of-code/rgsoc-teams/pulls/699", "author_association": "MEMBER", "_links": {"self": {"href": "https://api.github.com/repos/rails-girls-summer-of-code/rgsoc-teams/pulls/comments/106862829"}, "html": {"href": "https://github.com/rails-girls-summer-of-code/rgsoc-teams/pull/699#discussion_r106862829"}, "pull_request": {"href": "https://api.github.com/repos/rails-girls-summer-of-code/rgsoc-teams/pulls/699"}}, "body_html": "<p>should we test this also for <code>signed_off_at_project2</code>?</p>", "body_text": "should we test this also for signed_off_at_project2?"}