{"url": "https://api.github.com/repos/rails-girls-summer-of-code/rgsoc-teams/pulls/comments/164371150", "pull_request_review_id": 92131590, "id": 164371150, "diff_hunk": "@@ -63,7 +63,7 @@ def apply\n     if current_team.coaches_confirmed?\n       if application_draft.ready? && application_draft.submit_application!\n         flash[:notice] = 'Your application has been submitted!'\n-        ApplicationFormMailer.new_application(application_draft.application).deliver_later\n+        application_draft.application.notify_orga_and_submitters", "path": "app/controllers/application_drafts_controller.rb", "position": 5, "original_position": 5, "commit_id": "929f27afa972f460cfd36b8594325560ee2e8c5f", "original_commit_id": "e34a0c56688522fa6047e90e0a77bcaa8c78674d", "user": {"login": "klappradla", "id": 3491815, "avatar_url": "https://avatars3.githubusercontent.com/u/3491815?v=4", "gravatar_id": "", "url": "https://api.github.com/users/klappradla", "html_url": "https://github.com/klappradla", "followers_url": "https://api.github.com/users/klappradla/followers", "following_url": "https://api.github.com/users/klappradla/following{/other_user}", "gists_url": "https://api.github.com/users/klappradla/gists{/gist_id}", "starred_url": "https://api.github.com/users/klappradla/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/klappradla/subscriptions", "organizations_url": "https://api.github.com/users/klappradla/orgs", "repos_url": "https://api.github.com/users/klappradla/repos", "events_url": "https://api.github.com/users/klappradla/events{/privacy}", "received_events_url": "https://api.github.com/users/klappradla/received_events", "type": "User", "site_admin": false}, "body": "Haha, nice that we're on the same page here @carpodaster !\r\n\r\nI actually had both, the `ApplicationDraft` model's state machine and the `CreateApplicationEtc...` service refactored to do exactly this \ud83d\ude39 \r\n\r\nBut I had to adjust too many tests and did not have the time to finish this on Sunday. So I'll do it in another PR.\r\n\r\nBtw., a thing I changed there: I'd prefer the `CreateApplicationEtc.` service to actually **return** the persisted application record to then use this instance for notifying orga and the submitters. Using `deliver_later` for the emails requires all DB transactions for the `draft` and the `application` to be completed - assigning the `application` makes this a bit more explicit to me \u270c\ufe0f ", "created_at": "2018-01-29T09:21:31Z", "updated_at": "2018-01-29T17:59:29Z", "html_url": "https://github.com/rails-girls-summer-of-code/rgsoc-teams/pull/917#discussion_r164371150", "pull_request_url": "https://api.github.com/repos/rails-girls-summer-of-code/rgsoc-teams/pulls/917", "author_association": "MEMBER", "_links": {"self": {"href": "https://api.github.com/repos/rails-girls-summer-of-code/rgsoc-teams/pulls/comments/164371150"}, "html": {"href": "https://github.com/rails-girls-summer-of-code/rgsoc-teams/pull/917#discussion_r164371150"}, "pull_request": {"href": "https://api.github.com/repos/rails-girls-summer-of-code/rgsoc-teams/pulls/917"}}, "body_html": "<p>Haha, nice that we're on the same page here <a href=\"https://github.com/carpodaster\" class=\"user-mention\">@carpodaster</a> !</p>\n<p>I actually had both, the <code>ApplicationDraft</code> model's state machine and the <code>CreateApplicationEtc...</code> service refactored to do exactly this <g-emoji class=\"g-emoji\" alias=\"joy_cat\" fallback-src=\"https://assets-cdn.github.com/images/icons/emoji/unicode/1f639.png\">\ud83d\ude39</g-emoji></p>\n<p>But I had to adjust too many tests and did not have the time to finish this on Sunday. So I'll do it in another PR.</p>\n<p>Btw., a thing I changed there: I'd prefer the <code>CreateApplicationEtc.</code> service to actually <strong>return</strong> the persisted application record to then use this instance for notifying orga and the submitters. Using <code>deliver_later</code> for the emails requires all DB transactions for the <code>draft</code> and the <code>application</code> to be completed - assigning the <code>application</code> makes this a bit more explicit to me <g-emoji class=\"g-emoji\" alias=\"v\" fallback-src=\"https://assets-cdn.github.com/images/icons/emoji/unicode/270c.png\">\u270c\ufe0f</g-emoji></p>", "body_text": "Haha, nice that we're on the same page here @carpodaster !\nI actually had both, the ApplicationDraft model's state machine and the CreateApplicationEtc... service refactored to do exactly this \ud83d\ude39\nBut I had to adjust too many tests and did not have the time to finish this on Sunday. So I'll do it in another PR.\nBtw., a thing I changed there: I'd prefer the CreateApplicationEtc. service to actually return the persisted application record to then use this instance for notifying orga and the submitters. Using deliver_later for the emails requires all DB transactions for the draft and the application to be completed - assigning the application makes this a bit more explicit to me \u270c\ufe0f", "in_reply_to_id": 164368006}