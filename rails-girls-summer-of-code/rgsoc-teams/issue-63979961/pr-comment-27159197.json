{"url": "https://api.github.com/repos/rails-girls-summer-of-code/rgsoc-teams/pulls/comments/27159197", "pull_request_review_id": null, "id": 27159197, "diff_hunk": "@@ -69,8 +71,19 @@ def ready?\n     false # valid?(:apply)\n   end\n \n-  def state\n-    (applied_at? ? 'applied' : 'draft').inquiry\n+  aasm :column => :state, :no_direct_assignment => true do\n+    state :draft, :initial => true\n+    state :applied\n+\n+    event :submit_application do\n+      after do |applied_at_time = nil|\n+        self.applied_at = applied_at_time || Time.now\n+      end\n+\n+      # If the transition should only happen if the object is `ready?`,\n+      # add a :guard => :ready? here\n+      transitions :from => :draft, :to => :applied", "path": "app/models/application_draft.rb", "position": null, "original_position": 26, "commit_id": "813df1b94751b59bb63dc66d3ba11e6aeb0a9b43", "original_commit_id": "498a56f604a9f15696466fadda5140e7e8efd1b1", "user": {"login": "carpodaster", "id": 164400, "avatar_url": "https://avatars2.githubusercontent.com/u/164400?v=4", "gravatar_id": "", "url": "https://api.github.com/users/carpodaster", "html_url": "https://github.com/carpodaster", "followers_url": "https://api.github.com/users/carpodaster/followers", "following_url": "https://api.github.com/users/carpodaster/following{/other_user}", "gists_url": "https://api.github.com/users/carpodaster/gists{/gist_id}", "starred_url": "https://api.github.com/users/carpodaster/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/carpodaster/subscriptions", "organizations_url": "https://api.github.com/users/carpodaster/orgs", "repos_url": "https://api.github.com/users/carpodaster/repos", "events_url": "https://api.github.com/users/carpodaster/events{/privacy}", "received_events_url": "https://api.github.com/users/carpodaster/received_events", "type": "User", "site_admin": false}, "body": "The guard is indeed that the model should be valid in the `:apply` validation context (for which `#ready?` is just a proxy). It's short-circuited to `false` right now because we don't have the proper controller action in place that will actually accept the submitted application.\n\nCan you add the guard so that we don't forget it later?\n", "created_at": "2015-03-25T19:56:37Z", "updated_at": "2015-03-26T07:16:28Z", "html_url": "https://github.com/rails-girls-summer-of-code/rgsoc-teams/pull/171#discussion_r27159197", "pull_request_url": "https://api.github.com/repos/rails-girls-summer-of-code/rgsoc-teams/pulls/171", "author_association": "OWNER", "_links": {"self": {"href": "https://api.github.com/repos/rails-girls-summer-of-code/rgsoc-teams/pulls/comments/27159197"}, "html": {"href": "https://github.com/rails-girls-summer-of-code/rgsoc-teams/pull/171#discussion_r27159197"}, "pull_request": {"href": "https://api.github.com/repos/rails-girls-summer-of-code/rgsoc-teams/pulls/171"}}, "body_html": "<p>The guard is indeed that the model should be valid in the <code>:apply</code> validation context (for which <code>#ready?</code> is just a proxy). It's short-circuited to <code>false</code> right now because we don't have the proper controller action in place that will actually accept the submitted application.</p>\n<p>Can you add the guard so that we don't forget it later?</p>", "body_text": "The guard is indeed that the model should be valid in the :apply validation context (for which #ready? is just a proxy). It's short-circuited to false right now because we don't have the proper controller action in place that will actually accept the submitted application.\nCan you add the guard so that we don't forget it later?"}