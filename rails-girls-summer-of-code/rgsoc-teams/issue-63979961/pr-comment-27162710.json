{"url": "https://api.github.com/repos/rails-girls-summer-of-code/rgsoc-teams/pulls/comments/27162710", "pull_request_review_id": null, "id": 27162710, "diff_hunk": "@@ -69,8 +71,19 @@ def ready?\n     false # valid?(:apply)\n   end\n \n-  def state\n-    (applied_at? ? 'applied' : 'draft').inquiry\n+  aasm :column => :state, :no_direct_assignment => true do\n+    state :draft, :initial => true\n+    state :applied\n+\n+    event :submit_application do\n+      after do |applied_at_time = nil|\n+        self.applied_at = applied_at_time || Time.now\n+      end\n+\n+      # If the transition should only happen if the object is `ready?`,\n+      # add a :guard => :ready? here\n+      transitions :from => :draft, :to => :applied", "path": "app/models/application_draft.rb", "position": null, "original_position": 26, "commit_id": "813df1b94751b59bb63dc66d3ba11e6aeb0a9b43", "original_commit_id": "498a56f604a9f15696466fadda5140e7e8efd1b1", "user": {"login": "carpodaster", "id": 164400, "avatar_url": "https://avatars2.githubusercontent.com/u/164400?v=4", "gravatar_id": "", "url": "https://api.github.com/users/carpodaster", "html_url": "https://github.com/carpodaster", "followers_url": "https://api.github.com/users/carpodaster/followers", "following_url": "https://api.github.com/users/carpodaster/following{/other_user}", "gists_url": "https://api.github.com/users/carpodaster/gists{/gist_id}", "starred_url": "https://api.github.com/users/carpodaster/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/carpodaster/subscriptions", "organizations_url": "https://api.github.com/users/carpodaster/orgs", "repos_url": "https://api.github.com/users/carpodaster/repos", "events_url": "https://api.github.com/users/carpodaster/events{/privacy}", "received_events_url": "https://api.github.com/users/carpodaster/received_events", "type": "User", "site_admin": false}, "body": "Can you add a test that checks that one can / cannot transition to `applied` with stubbed return values of `ready?` ?\n", "created_at": "2015-03-25T20:31:58Z", "updated_at": "2015-03-26T07:16:28Z", "html_url": "https://github.com/rails-girls-summer-of-code/rgsoc-teams/pull/171#discussion_r27162710", "pull_request_url": "https://api.github.com/repos/rails-girls-summer-of-code/rgsoc-teams/pulls/171", "author_association": "OWNER", "_links": {"self": {"href": "https://api.github.com/repos/rails-girls-summer-of-code/rgsoc-teams/pulls/comments/27162710"}, "html": {"href": "https://github.com/rails-girls-summer-of-code/rgsoc-teams/pull/171#discussion_r27162710"}, "pull_request": {"href": "https://api.github.com/repos/rails-girls-summer-of-code/rgsoc-teams/pulls/171"}}, "body_html": "<p>Can you add a test that checks that one can / cannot transition to <code>applied</code> with stubbed return values of <code>ready?</code> ?</p>", "body_text": "Can you add a test that checks that one can / cannot transition to applied with stubbed return values of ready? ?"}